{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\el\\xEDsabet\\\\Documents\\\\web-dev\\\\react\\\\react_final_exam\\\\client\\\\src\\\\pages\\\\Profile.js\";\nimport React, { useState, useEffect } from \"react\";\nimport axios from 'axios';\nimport isAuthorized from '../auth/isAuthorized';\nimport Review from '../components/Review';\nimport { Link, useHistory } from \"react-router-dom\";\nimport { BsHeartFill, BsFillTrashFill, BsFillStarFill } from \"react-icons/bs\";\nimport '../css/profile.css';\nimport { makeStyles } from '@material-ui/styles';\nimport { Button, FormControl, Input, InputLabel } from '@material-ui/core';\nconst useStyles = makeStyles(theme => ({\n  submit: {\n    marginTop: theme.spacing * 3,\n    justifySelf: 'center',\n    color: 'white'\n  },\n  delete: {\n    backgroundColor: 'rgb(61, 60, 60)',\n    color: 'white'\n  }\n}));\n\nconst Profile = props => {\n  const classes = useStyles();\n  const [booksInLibrary, setBooks] = useState();\n  const [reviewedBooks, setReviewedBooks] = useState();\n  const [edit, setEdit] = useState(false);\n  const [newFirstname, setNewFirstname] = useState();\n  const [newLastname, setNewLastname] = useState();\n  const [newEmail, setNewEmail] = useState();\n  const [deleteModel, setDeleteModel] = useState(false);\n  let history = useHistory();\n  useEffect(() => {\n    let isFetching = true;\n\n    const fetchBooksInLibrary = async () => {\n      try {\n        const response = await axios('http://localhost/getBooksInLibrary');\n        console.log(response.data);\n\n        if (isFetching) {\n          setBooks(response.data);\n        }\n      } catch (err) {\n        if (err) {\n          props.onError(err.response.data.error);\n        }\n      }\n    };\n\n    const fetchReviewedBooks = async () => {\n      try {\n        const response = await axios('http://localhost/getUserReviewedBooks');\n        console.log(response.data);\n\n        if (isFetching) {\n          setReviewedBooks(response.data);\n        }\n      } catch (err) {\n        if (err) {\n          props.onError(err.response.data.error);\n        }\n      }\n    };\n\n    if (props.isAuthorized) {\n      fetchBooksInLibrary();\n      fetchReviewedBooks();\n    }\n\n    return () => isFetching = false;\n  }, [props.isAuthorized]);\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    console.log('submit profile changes'); // if(!newEmail || !newFirstname || !newLastname){\n    //                \n    // }\n\n    if (newEmail || newFirstname || newLastname) {\n      try {\n        const response = await axios.post('http://localhost/user/update', {\n          newFirstname,\n          newLastname,\n          newEmail\n        });\n        console.log(response.data);\n        props.onNotification(response.data.response);\n        setEdit(false);\n      } catch (err) {\n        if (err) {\n          props.onError(err.response.data.error);\n        }\n      }\n    } else {\n      props.onError('Please fill out information you would like changed');\n    }\n  };\n\n  const showDeleteModel = () => {\n    console.log('delete');\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"model\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"model-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 17\n      }\n    }, \"Are you sure you want to delete your account?\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }\n    }, \"This action cannot be reversed\"), /*#__PURE__*/React.createElement(Button, {\n      type: \"submit\",\n      fullWidth: true,\n      variant: \"contained\",\n      className: classes.delete,\n      onClick: deleteAccount,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 18\n      }\n    }, \"Delete\"), /*#__PURE__*/React.createElement(Button, {\n      type: \"submit\",\n      fullWidth: true,\n      color: \"secondary\",\n      variant: \"contained\",\n      className: classes.submit,\n      onClick: () => setDeleteModel(false),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 17\n      }\n    }, \"Cancel\")));\n  };\n\n  const deleteAccount = async () => {\n    try {\n      const response = await axios.delete('http://localhost/user/deleteAccount');\n      console.log(response.data);\n      props.onNotification(response.data.response);\n      history.push('/read_it/');\n    } catch (err) {\n      if (err) {\n        props.onError(err.response.data.error);\n      }\n    }\n  };\n\n  const handleClick = async id => {\n    console.log('remove from library', id);\n\n    try {\n      const response = await axios.post('http://localhost/removeBookFromLibrary', {\n        likedBookID: id\n      });\n      console.log(response.data);\n      console.log(booksInLibrary);\n      const newBooksInLibrary = booksInLibrary.filter(book => book.book_id !== id);\n      setBooks(newBooksInLibrary);\n    } catch (err) {\n      if (err) {\n        props.onError(err.response.data.error);\n      }\n    }\n  };\n\n  const handleDeleteReview = async id => {\n    try {\n      const response = await axios.post('http://localhost/deleteReview', {\n        id: props.id\n      });\n      console.log(response.data);\n      props.onNotification(response.data.response);\n      const newReviewedBooks = reviewedBooks.filter(review => review.id !== id);\n      setReviewedBooks(newReviewedBooks);\n    } catch (err) {\n      if (err) {\n        props.onError(err.response.data.error);\n      }\n    }\n  };\n\n  if (!props.isAuthorized) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"notAuthorized\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 18\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 13\n      }\n    }, \"Log in to view your profile\"), /*#__PURE__*/React.createElement(Link, {\n      to: \"/read_it/login\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 13\n      }\n    }, \" Login\"));\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"profile\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 13\n    }\n  }, \"Your Library\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"library\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 13\n    }\n  }, booksInLibrary ? booksInLibrary.map(book => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"book\",\n      key: book.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(BsHeartFill, {\n      className: \"heartIcon\",\n      onClick: () => handleClick(book.book_id),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 29\n      }\n    }), /*#__PURE__*/React.createElement(\"img\", {\n      src: book.img,\n      alt: \"Book cover\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 29\n      }\n    }), /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 29\n      }\n    }, book.title), /*#__PURE__*/React.createElement(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 29\n      }\n    }, book.author), /*#__PURE__*/React.createElement(Link, {\n      to: \"/read_it/reviewbook/\" + book.book_id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 29\n      }\n    }, \"Review Book\"));\n  }) : /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 18\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 21\n    }\n  }, \"There appears to be nothing in your library\"), /*#__PURE__*/React.createElement(Link, {\n    to: \"/\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 21\n    }\n  }, \"Browse Books\")))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"userReviews\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 17\n    }\n  }, \"Your Reviews\"), reviewedBooks ? reviewedBooks.map(review => {\n    return /*#__PURE__*/React.createElement(Review, Object.assign({}, review, {\n      onDelete: handleDeleteReview,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 28\n      }\n    }));\n  }) : null), /*#__PURE__*/React.createElement(\"button\", {\n    className: edit ? 'shown editBtn' : 'editBtn',\n    onClick: () => edit ? setEdit(false) : setEdit(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 9\n    }\n  }, \"Edit your information\"), /*#__PURE__*/React.createElement(\"form\", {\n    className: edit ? 'showForm editForm' : 'editForm',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 13\n    }\n  }, \"Update your information\"), /*#__PURE__*/React.createElement(FormControl, {\n    margin: \"normal\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 14\n    }\n  }, /*#__PURE__*/React.createElement(InputLabel, {\n    htmlFor: \"newFirstname\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 17\n    }\n  }, \"Firstname\"), /*#__PURE__*/React.createElement(Input, {\n    name: \"newFirstname\",\n    type: \"text\",\n    id: \"newFirstname\",\n    onChange: e => setNewFirstname(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(FormControl, {\n    margin: \"normal\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 12\n    }\n  }, /*#__PURE__*/React.createElement(InputLabel, {\n    htmlFor: \"newLastname\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 17\n    }\n  }, \"Lastname\"), /*#__PURE__*/React.createElement(Input, {\n    name: \"newLastname\",\n    type: \"text\",\n    id: \"newLastname\",\n    onChange: e => setNewLastname(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(FormControl, {\n    margin: \"normal\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(InputLabel, {\n    htmlFor: \"newEmail\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 16\n    }\n  }, \"Email\"), /*#__PURE__*/React.createElement(Input, {\n    name: \"newEmail\",\n    type: \"text\",\n    id: \"newEmail\",\n    onChange: e => setNewEmail(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    fullWidth: true,\n    variant: \"contained\",\n    color: \"secondary\",\n    className: classes.submit,\n    onClick: e => handleSubmit(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 11\n    }\n  }, \"Submit Changes\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dltBtn btn\",\n    onClick: () => setDeleteModel(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 10\n    }\n  }, /*#__PURE__*/React.createElement(BsFillTrashFill, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 75\n    }\n  }), \"Delete Account\"), deleteModel ? showDeleteModel() : null);\n};\n\nexport default isAuthorized(Profile);","map":{"version":3,"sources":["C:/Users/elÃ­sabet/Documents/web-dev/react/react_final_exam/client/src/pages/Profile.js"],"names":["React","useState","useEffect","axios","isAuthorized","Review","Link","useHistory","BsHeartFill","BsFillTrashFill","BsFillStarFill","makeStyles","Button","FormControl","Input","InputLabel","useStyles","theme","submit","marginTop","spacing","justifySelf","color","delete","backgroundColor","Profile","props","classes","booksInLibrary","setBooks","reviewedBooks","setReviewedBooks","edit","setEdit","newFirstname","setNewFirstname","newLastname","setNewLastname","newEmail","setNewEmail","deleteModel","setDeleteModel","history","isFetching","fetchBooksInLibrary","response","console","log","data","err","onError","error","fetchReviewedBooks","handleSubmit","e","preventDefault","post","onNotification","showDeleteModel","deleteAccount","push","handleClick","id","likedBookID","newBooksInLibrary","filter","book","book_id","handleDeleteReview","newReviewedBooks","review","map","img","title","author","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\"\r\nimport axios from 'axios'\r\n\r\nimport isAuthorized from '../auth/isAuthorized'\r\nimport Review from '../components/Review'\r\n\r\nimport { Link, useHistory } from \"react-router-dom\"\r\nimport { BsHeartFill, BsFillTrashFill, BsFillStarFill } from \"react-icons/bs\";\r\nimport '../css/profile.css'\r\n\r\nimport { makeStyles } from '@material-ui/styles'\r\nimport {\r\n    Button,\r\n    FormControl,\r\n    Input,\r\n    InputLabel\r\n  } from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    submit: {\r\n     marginTop: theme.spacing * 3,\r\n     justifySelf: 'center',\r\n     color:'white'\r\n   },\r\n   delete: {\r\n       backgroundColor: 'rgb(61, 60, 60)',\r\n       color:'white'\r\n   }\r\n }));\r\n\r\nconst Profile = (props) => {\r\n    const classes = useStyles()\r\n\r\n    const [ booksInLibrary, setBooks ] = useState()\r\n    const [ reviewedBooks, setReviewedBooks ] = useState()\r\n    const [ edit, setEdit ] = useState(false)\r\n    const [ newFirstname, setNewFirstname ] = useState()\r\n    const [ newLastname, setNewLastname ] = useState()\r\n    const [ newEmail, setNewEmail ] = useState()\r\n\r\n    const [ deleteModel, setDeleteModel ] = useState(false)\r\n\r\n\r\n    let history = useHistory()\r\n    \r\n    \r\n   \r\n   \r\n    useEffect(() => {\r\n        let isFetching = true\r\n      \r\n        const fetchBooksInLibrary = async () => {\r\n            try{\r\n                const response = await axios('http://localhost/getBooksInLibrary')\r\n                console.log(response.data)\r\n                if(isFetching){\r\n                    setBooks(response.data)\r\n                }\r\n            }catch(err){\r\n                if(err){\r\n                    props.onError(err.response.data.error)\r\n                 }\r\n            }\r\n           \r\n        }\r\n        const fetchReviewedBooks = async () => {\r\n            try{\r\n                const response = await axios('http://localhost/getUserReviewedBooks')\r\n                console.log(response.data)\r\n                if(isFetching){\r\n                    setReviewedBooks(response.data)\r\n                }\r\n            }catch(err){\r\n                if(err){\r\n                    props.onError(err.response.data.error)\r\n                 }\r\n            }\r\n           \r\n        }\r\n        if(props.isAuthorized){\r\n\r\n            fetchBooksInLibrary()\r\n            fetchReviewedBooks()\r\n        }\r\n        return () => isFetching = false\r\n    },[props.isAuthorized])\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault()\r\n        console.log('submit profile changes')\r\n        // if(!newEmail || !newFirstname || !newLastname){\r\n        //                \r\n        // }\r\n        if(newEmail || newFirstname || newLastname){\r\n            try{\r\n                const response = await axios.post('http://localhost/user/update', {\r\n                    newFirstname,\r\n                    newLastname,\r\n                    newEmail\r\n                })\r\n            console.log(response.data)\r\n            props.onNotification(response.data.response)\r\n            setEdit(false)\r\n            }catch(err){\r\n                if(err){\r\n                    props.onError(err.response.data.error)                    \r\n                 }\r\n            }\r\n           \r\n       \r\n\r\n        }else{\r\n            props.onError('Please fill out information you would like changed') \r\n        }\r\n    }\r\n    const showDeleteModel = () => {\r\n        console.log('delete')\r\n        return(\r\n            <div className=\"model\">\r\n                <div className=\"model-content\">\r\n                <h2>Are you sure you want to delete your account?</h2>\r\n                <p>This action cannot be reversed</p>\r\n                 <Button type=\"submit\"\r\n                    fullWidth\r\n                    variant=\"contained\"\r\n                    className={classes.delete}  \r\n                    onClick={deleteAccount}>Delete</Button> \r\n                <Button type=\"submit\"\r\n                    fullWidth\r\n                    color=\"secondary\"\r\n                    variant=\"contained\"\r\n                    className={classes.submit}  \r\n                    onClick={()=>setDeleteModel(false)}>Cancel</Button>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n    \r\n    const deleteAccount = async () => {\r\n        try{\r\n            const response =  await axios.delete('http://localhost/user/deleteAccount')\r\n        console.log(response.data)\r\n        props.onNotification(response.data.response)\r\n            history.push('/read_it/')\r\n        }catch(err){\r\n            if(err){\r\n                props.onError(err.response.data.error)\r\n                \r\n             }\r\n        }\r\n       \r\n    }\r\n\r\n\r\n    const handleClick = async (id) => {\r\n        console.log('remove from library', id)\r\n        try{\r\n            const response = await axios.post('http://localhost/removeBookFromLibrary', {likedBookID: id})\r\n            console.log(response.data)\r\n            console.log(booksInLibrary)\r\n            const newBooksInLibrary = booksInLibrary.filter(book=> book.book_id !== id)\r\n            setBooks(newBooksInLibrary)\r\n        }catch(err){\r\n            if(err){\r\n                props.onError(err.response.data.error)\r\n            }\r\n        }       \r\n    }\r\n\r\n    const handleDeleteReview = async (id) => {\r\n        try{\r\n            const response =  await axios.post('http://localhost/deleteReview', {id: props.id})\r\n        console.log(response.data)\r\n        props.onNotification(response.data.response)\r\n        const newReviewedBooks = reviewedBooks.filter(review => review.id !== id)\r\n        setReviewedBooks(newReviewedBooks)\r\n            \r\n        }catch(err){\r\n            if(err){\r\n                props.onError(err.response.data.error)                \r\n             }\r\n        }\r\n    }\r\n\r\n    if(!props.isAuthorized){\r\n         return (<div className=\"notAuthorized\">\r\n            <h1>Log in to view your profile</h1>\r\n            <Link to=\"/read_it/login\"> Login</Link></div>)\r\n    }\r\n\r\n    return(\r\n        <div className=\"profile\">\r\n       \r\n        <div>            \r\n            <h2>Your Library</h2>\r\n            <div className=\"library\">\r\n            {booksInLibrary?\r\n                booksInLibrary.map(book => {\r\n                    return (<div className='book' key={book.id} >\r\n                            <BsHeartFill className=\"heartIcon\" onClick={()=>handleClick(book.book_id)}/>\r\n                            <img src={book.img} alt=\"Book cover\"/>\r\n                            <h3>{book.title}</h3>\r\n                            <h4>{book.author}</h4>\r\n                            <Link to={\"/read_it/reviewbook/\"+book.book_id}>Review Book</Link>\r\n                        </div>)\r\n                })\r\n                :<div>\r\n                    <h2>There appears to be nothing in your library</h2>\r\n                    <Link to=\"/\">Browse Books</Link>\r\n                </div>}\r\n            </div>\r\n        </div>\r\n        <div className=\"userReviews\">\r\n                <h2>Your Reviews</h2>\r\n                {reviewedBooks?\r\n                reviewedBooks.map(review => {\r\n                    return <Review {...review} onDelete={handleDeleteReview}/>\r\n                })\r\n                :null}\r\n                \r\n        </div>\r\n        \r\n        <button className={edit? 'shown editBtn': 'editBtn'} onClick={() => edit? setEdit(false): setEdit(true)}>Edit your information</button>\r\n        <form className={edit? 'showForm editForm' :'editForm'}>\r\n            <h3>Update your information</h3>\r\n             <FormControl margin=\"normal\"  fullWidth>\r\n                <InputLabel htmlFor=\"newFirstname\">Firstname</InputLabel>\r\n                <Input name=\"newFirstname\" type=\"text\" id=\"newFirstname\"  onChange={(e) => setNewFirstname(e.target.value)}/>\r\n          </FormControl> \r\n           <FormControl margin=\"normal\"  fullWidth>\r\n                <InputLabel htmlFor=\"newLastname\">Lastname</InputLabel>\r\n                <Input name=\"newLastname\" type=\"text\" id=\"newLastname\"  onChange={(e) => setNewLastname(e.target.value)}/>\r\n          </FormControl> \r\n            <FormControl margin=\"normal\"  fullWidth>\r\n               <InputLabel htmlFor=\"newEmail\">Email</InputLabel>\r\n                <Input name=\"newEmail\" type=\"text\" id=\"newEmail\"  onChange={(e) => setNewEmail(e.target.value)}/>\r\n          </FormControl>\r\n          <Button\r\n            type=\"submit\"\r\n            fullWidth\r\n            variant=\"contained\"\r\n            color=\"secondary\"\r\n            className={classes.submit}\r\n            onClick={(e) => handleSubmit(e)}>Submit Changes</Button> \r\n         </form>\r\n         <div className=\"dltBtn btn\" onClick={() => setDeleteModel(true)}><BsFillTrashFill />Delete Account</div>\r\n         {deleteModel? showDeleteModel(): null}\r\n        </div>\r\n    )\r\n\r\n}\r\nexport default isAuthorized(Profile)"]},"metadata":{},"sourceType":"module"}