{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\el\\xEDsabet\\\\Documents\\\\web-dev\\\\react\\\\react_final_exam\\\\client\\\\src\\\\pages\\\\Reviews.js\";\nimport React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport '../css/review.css';\nimport Review from \"../components/Review\";\nimport { makeStyles } from '@material-ui/styles';\nimport { Button, FormControl, Input, InputLabel } from '@material-ui/core';\nconst useStyles = makeStyles(theme => ({\n  submit: {\n    marginTop: theme.spacing * 3,\n    justifySelf: 'center',\n    color: 'white'\n  }\n}));\nexport default function Reviews(props) {\n  const classes = useStyles();\n  const [reviews, setReviews] = useState();\n  const [searchStr, setSearchStr] = useState();\n  const [clearSearch, setClearSearch] = useState(false);\n  useEffect(() => {\n    let isFetching = true;\n\n    const fetchReviews = async () => {\n      try {\n        const response = await axios('http://localhost/getReviews');\n        console.log(response.data);\n\n        if (isFetching) {\n          setReviews(response.data);\n        }\n      } catch (err) {\n        if (err) {\n          props.onError(err.response.data.error);\n        }\n      }\n    };\n\n    fetchReviews();\n    return () => isFetching = false;\n  }, [props, clearSearch]);\n\n  const handleDeleteReview = async id => {\n    try {\n      const response = await axios.post('http://localhost/deleteReview', {\n        id\n      });\n      console.log(response.data);\n      props.onNotification(response.data.response);\n      const newReviewedBooks = reviews.filter(review => review.id !== id);\n      setReviews(newReviewedBooks);\n    } catch (err) {\n      if (err) {\n        props.onError(err.response.data.error);\n      }\n    }\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n\n    if (searchStr) {\n      const matches = reviews.filter(review => {\n        console.log(review);\n\n        if (review.book_title.toLowerCase().includes(searchStr.toLowerCase()) || review.user.first_name.toLowerCase().includes(searchStr.toLowerCase()) || review.user.last_name.toLowerCase().includes(searchStr.toLowerCase())) {\n          return review;\n        }\n      });\n      console.log(matches.length);\n\n      if (matches.length === 0) {\n        console.log(matches);\n        props.onError('No reviews match your search');\n        return;\n      } else {\n        setReviews(matches);\n      }\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"reviewsWrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 13\n    }\n  }, \"Reviews\"), searchStr ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"clearBtn btn\",\n    onClick: () => setClearSearch(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 29\n    }\n  }, \"Clear Search\") : null, /*#__PURE__*/React.createElement(\"form\", {\n    className: \"searchForm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(FormControl, {\n    margin: \"normal\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(InputLabel, {\n    htmlFor: \"searchStr\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 21\n    }\n  }, \"Search for Reviews\"), /*#__PURE__*/React.createElement(Input, {\n    name: \"searchStr\",\n    type: \"text\",\n    id: \"searchStr\",\n    onChange: e => setSearchStr(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    fullWidth: true,\n    variant: \"contained\",\n    color: \"secondary\",\n    className: classes.submit,\n    onClick: e => handleSubmit(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 17\n    }\n  }, \"Search\")), reviews ? reviews.map(review => {\n    return /*#__PURE__*/React.createElement(Review, Object.assign({}, review, {\n      key: review.id,\n      onDelete: handleDeleteReview,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 24\n      }\n    }));\n  }) : null);\n}","map":{"version":3,"sources":["C:/Users/elÃ­sabet/Documents/web-dev/react/react_final_exam/client/src/pages/Reviews.js"],"names":["React","useState","useEffect","axios","Review","makeStyles","Button","FormControl","Input","InputLabel","useStyles","theme","submit","marginTop","spacing","justifySelf","color","Reviews","props","classes","reviews","setReviews","searchStr","setSearchStr","clearSearch","setClearSearch","isFetching","fetchReviews","response","console","log","data","err","onError","error","handleDeleteReview","id","post","onNotification","newReviewedBooks","filter","review","handleSubmit","e","preventDefault","matches","book_title","toLowerCase","includes","user","first_name","last_name","length","target","value","map"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport '../css/review.css'\r\nimport Review from \"../components/Review\";\r\n\r\nimport { makeStyles } from '@material-ui/styles'\r\nimport {\r\n    Button,\r\n    FormControl,\r\n    Input,\r\n    InputLabel\r\n  } from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n     submit: {\r\n      marginTop: theme.spacing * 3,\r\n      justifySelf: 'center',\r\n      color:'white'\r\n    },\r\n  }));\r\n\r\nexport default function Reviews(props) {\r\n\r\n    const classes = useStyles()\r\n\r\n    const [ reviews, setReviews ] = useState()\r\n    const [ searchStr, setSearchStr ] = useState()\r\n    const [ clearSearch, setClearSearch ] = useState(false)\r\n\r\n    useEffect(() => {\r\n        let isFetching = true\r\n        const fetchReviews = async () => {\r\n            try{\r\n                const response = await axios('http://localhost/getReviews')\r\n                console.log(response.data)\r\n                if(isFetching){\r\n                    setReviews(response.data)\r\n                }\r\n            }catch(err){\r\n                if(err){\r\n                    props.onError(err.response.data.error)\r\n                 }\r\n            }\r\n           \r\n        } \r\n        fetchReviews()\r\n        return () => isFetching= false\r\n    },[props, clearSearch])\r\n\r\n    const handleDeleteReview = async (id) => {\r\n        try{\r\n            const response =  await axios.post('http://localhost/deleteReview', {id})\r\n        console.log(response.data)\r\n        props.onNotification(response.data.response)\r\n        const newReviewedBooks = reviews.filter(review => review.id !== id)\r\n        setReviews(newReviewedBooks)\r\n            \r\n        }catch(err){\r\n            if(err){\r\n                props.onError(err.response.data.error)                \r\n             }\r\n        }\r\n    }\r\n\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault()\r\n        if(searchStr){\r\n           const matches = reviews.filter(review => {\r\n               console.log(review)\r\n            if(review.book_title.toLowerCase().includes(searchStr.toLowerCase()) \r\n            || review.user.first_name.toLowerCase().includes(searchStr.toLowerCase()) \r\n            || review.user.last_name.toLowerCase().includes(searchStr.toLowerCase()) ){\r\n                return review\r\n            }\r\n        })\r\n        console.log(matches.length)\r\n        if(matches.length === 0){\r\n            console.log(matches)\r\n            props.onError('No reviews match your search')\r\n            return\r\n        }else{\r\n            setReviews(matches)\r\n\r\n        }\r\n        }\r\n    }\r\n\r\n    return(\r\n        <div className=\"reviewsWrapper\">\r\n            <h1>Reviews</h1>\r\n                {searchStr? <div className=\"clearBtn btn\" onClick={() => setClearSearch(true)}>Clear Search</div>:null}\r\n            <form className=\"searchForm\">\r\n                <FormControl margin=\"normal\" fullWidth>\r\n                    <InputLabel htmlFor=\"searchStr\">Search for Reviews</InputLabel>\r\n                    <Input name=\"searchStr\" type=\"text\" id=\"searchStr\"  onChange={(e) => setSearchStr(e.target.value)}/>\r\n                </FormControl>\r\n                <Button\r\n                    type=\"submit\"\r\n                    fullWidth\r\n                    variant=\"contained\"\r\n                    color=\"secondary\"\r\n                    className={classes.submit}\r\n                    onClick={(e)=> handleSubmit(e)}\r\n                    >Search</Button>\r\n            </form>\r\n            {reviews ? \r\n            reviews.map(review => {\r\n                return <Review {...review} key={review.id} onDelete={handleDeleteReview}/>                \r\n            })\r\n        : null}\r\n        \r\n        </div>\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}